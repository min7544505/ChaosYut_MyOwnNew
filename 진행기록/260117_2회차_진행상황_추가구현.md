# 260117_2회차_진행상황_추가구현.md

```markdown
# 2회차 진행상황 - 추가 구현

## 날짜: 2025-01-17

---

## 완료된 작업

### 1. SpawnRoadByType 함수 구현

**경로**: BP_YutBoard → Functions → SpawnRoadByType

**역할**: DataTable의 한 행(Row) 데이터를 받아서, RoadType에 따라 적절한 Road 액터를 생성하고 반환

#### 함수 정의

| 항목 | 값 |
|------|-----|
| Input | RoadData (ST_RoadData) |
| Output | SpawnedRoad (BP_RoadBase) |

#### 로직 흐름

```
[Input: RoadData]
        ↓
[Break ST_RoadData] → RoadType, PositionX, PositionY, PositionZ, RoadID 등
        ↓
[Switch on E_RoadType] ← RoadType
        │
        ├─ Normal → [Spawn Actor] Class: RoadBaseClass
        ├─ Branch → [Spawn Actor] Class: BranchRoadClass
        ├─ Merge  → [Spawn Actor] Class: MergeRoadClass
        └─ Center → [Spawn Actor] Class: CenterRoadClass
        ↓
[Make Vector] ← PositionX, PositionY, PositionZ
        ↓
[Make Transform] ← Location
        ↓
[Spawn Actor] ← Class, Transform
        ↓
[SET SpawnedRoad] (로컬 변수에 저장)
        ↓
[SET RoadID] ← RoadData.RoadID
        ↓
[SET RoadType] ← RoadData.RoadType
        ↓
[SET IsCorner] ← RoadData.IsCorner
        ↓
[SET IsDiagonal] ← RoadData.IsDiagonal
        ↓
[Return Node] ← SpawnedRoad
```

#### 사용된 변수

| 변수명 | 타입 | 용도 |
|--------|------|------|
| SpawnedRoad | BP_RoadBase (로컬) | 스폰된 액터 임시 저장 |
| RoadBaseClass | BP_RoadBase Class Reference | Normal 타입용 클래스 |
| BranchRoadClass | BP_BranchRoad Class Reference | Branch 타입용 클래스 |
| MergeRoadClass | BP_MergeRoad Class Reference | Merge 타입용 클래스 |
| CenterRoadClass | BP_CenterRoad Class Reference | Center 타입용 클래스 |

---

### 2. InitializeBoard 함수 구현

**경로**: BP_YutBoard → Functions → InitializeBoard

**역할**: DataTable의 29개 행을 읽어서 29개 Road 액터를 생성하고 AllRoads Map에 저장

#### 로직 흐름

```
[함수 시작]
        ↓
[Get Data Table Row Names]
    └── Table: DT_BoardLayout
    └── Out Row Names: 29개 이름 배열
        ↓
[For Each Loop]
    ├── Array: Out Row Names
    │
    ├── Loop Body (29번 반복)
    │       ↓
    │   [Get Data Table Row]
    │       ├── Data Table: DT_BoardLayout
    │       ├── Row Name: Array Element
    │       └── Out Row: ST_RoadData
    │       ↓
    │   [Break ST_RoadData] (Out Row에서)
    │       ↓
    │   [SpawnRoadByType]
    │       ├── RoadData: Out Row
    │       └── Return: SpawnedRoad
    │       ↓
    │   [Add (Map)]
    │       ├── Target: AllRoads
    │       ├── Key: RoadID (Break에서)
    │       └── Value: SpawnedRoad
    │
    └── Completed (반복 완료 후)
            ↓
        [Find (Map)]
            ├── Target: AllRoads
            ├── Key: "C1" (Make Literal Name)
            └── Value: 찾은 Road 액터
            ↓
        [SET StartRoad] ← Value
            ↓
        [SetupConnections] (빈 함수, 추후 구현)
```

#### 사용된 변수

| 변수명 | 타입 | 용도 |
|--------|------|------|
| AllRoads | Map (Name → BP_RoadBase) | 모든 Road 액터 저장 |
| StartRoad | BP_RoadBase | 시작점 (C1) 참조 |
| BoardLayoutTable | DataTable | DT_BoardLayout 참조 |

---

## 학습 내용

### 1. IsDiagonal 필드

**용도**: 해당 정점이 대각선 경로(지름길)에 속하는지 표시

| 경로 타입 | IsDiagonal 값 |
|-----------|---------------|
| 외곽 경로 (O_L, O_J 등) | false |
| 대각선 경로 (D_A, D_B, CENTER 등) | true |

**사용 시점**:
- 분기점(C2, C3)에서 다음 경로 선택 시
- 합류점(C1, C4)에서 백도 시 경로 선택 UI 표시

**규칙 수정**: 백도 시 왔던 경로대로 돌아가는 것이 아니라, 플레이어가 자유롭게 선택 가능

---

### 2. Class Reference

**개념**: 클래스 "설계도"를 변수로 저장하는 타입

| 구분 | 저장하는 것 | 용도 |
|------|-------------|------|
| Object Reference | 실제 인스턴스 | 이미 생성된 액터 참조 |
| Class Reference | 클래스 정의 | SpawnActor로 동적 생성 시 |

**Blueprint에서 생성**:
1. 변수 타입 선택 → 클래스 검색
2. "Class Reference" 선택

---

### 3. Map 자료구조

**개념**: Key-Value 쌍을 저장하는 자료구조

| 용어 | 의미 | 윷판 예시 |
|------|------|----------|
| Map | Key-Value 저장소 | AllRoads 변수 |
| Key | 검색어 (고유) | "C1", "C2", "CENTER" |
| Value | 저장할 값 | Road 액터들 |

**Array vs Map**:
- Array: 순서(Index)로 접근 → Array[0], Array[1]
- Map: 이름(Key)으로 접근 → Map["C1"], Map["CENTER"]

**Blueprint에서 Map 변수 생성**:
1. Add (Map) 노드에 Key, Value 먼저 연결
2. Target 핀 우클릭 → "변수로 승격"
3. 변수 이름 변경

---

### 4. For Each Loop 동작

**Get Data Table Row Names** → 이름 배열 반환
```
["Row_0", "Row_1", "Row_2", ... "Row_28"]
```

**For Each Loop** → 하나씩 꺼내서 반복
```
1회차: Array Element = "Row_0" → Loop Body 실행
2회차: Array Element = "Row_1" → Loop Body 실행
...
29회차: Array Element = "Row_28" → Loop Body 실행
        ↓
Completed 핀 실행
```

**핀 설명**:
| 핀 | 역할 |
|----|------|
| Array | 반복할 배열 |
| Loop Body | 매 반복마다 실행 |
| Array Element | 현재 꺼낸 값 |
| Completed | 모든 반복 끝나면 실행 |

---

## 다음 작업 예정

1. **SetupConnections 함수 구현**
   - 각 Road 액터의 NextRoads, PrevRoads 연결 설정

2. **BP_RoadBase 함수 구현**
   - GetNextRoad(bPreferDiagonal)
   - GetPrevRoad(bPreferDiagonal)
   - OnPieceEnter(Piece)
   - OnPieceExit(Piece)

3. **BP_BranchRoad, BP_MergeRoad, BP_CenterRoad 구현**
   - 각 타입별 특수 로직 추가

---

## 파일 구조

```
BP_YutBoard
├── Variables
│   ├── BoardLayoutTable (DataTable)
│   ├── AllRoads (Map: Name → BP_RoadBase)
│   ├── StartRoad (BP_RoadBase)
│   ├── RoadBaseClass (Class Reference)
│   ├── BranchRoadClass (Class Reference)
│   ├── MergeRoadClass (Class Reference)
│   └── CenterRoadClass (Class Reference)
│
└── Functions
    ├── InitializeBoard
    ├── SpawnRoadByType
    └── SetupConnections (빈 함수)
```
```

---

이 내용을 `진행기록/260117_2회차_진행상황_추가구현.md` 파일로 저장하시면 됩니다!